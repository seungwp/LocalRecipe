<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>main</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #e8f5e9;
    }
    .banner {
      background-color: #66bb6a;
      color: white;
      text-align: center;
      padding: 50px 0;
      font-size: 36px;
      font-weight: bold;
    }
    .menu-bar {
      background-color: #a5d6a7;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
    }
    .menu-bar ul {
      list-style: none;
      display: flex;
      margin: 0;
      padding: 0;
    }
    .menu-bar ul li {
      margin: 0 10px;
    }
    .menu-bar ul li a {
      color: #2e7d32;
      text-decoration: none;
      font-weight: bold;
    }
    .container {
      padding: 30px;
    }
    .row-box {
      display: flex;
      justify-content: space-between;
      gap: 20px;
      flex-wrap: wrap;
    }
    .upload-section, .roulette-section {
      flex: 1;
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      min-width: 300px;
    }
    #ingredientResult {
      margin-top: 20px;
      font-weight: bold;
    }
    .ingredient-item {
      margin-bottom: 5px;
    }
    button {
      background-color: #66bb6a;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }
    button:hover {
      background-color: #43a047;
    }
    .wheel {
      width: 100%;
      height: 300px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 10px solid #a5d6a7;
      border-radius: 50%;
      font-size: 24px;
      font-weight: bold;
      color: #2e7d32;
      margin: 20px 0;
      background-color: #c8e6c9;
    }
  </style>
</head>
<body>
<div class="banner">ë©”ì¸ í˜ì´ì§€</div>
<div class="menu-bar">
  <ul>
    <li><a href="/pages/index">í™ˆ</a></li>
    <li><a href="/pages/board">ê²Œì‹œíŒ</a></li>
  </ul>
  <ul>
    <li><a href="/logout">ë¡œê·¸ì•„ì›ƒ</a></li>
  </ul>
</div>

<div class="container">
  <div class="row-box">
    <!-- OCR ì—…ë¡œë“œ ì„¹ì…˜ -->
    <div class="upload-section">
      <h3>ğŸ“¸ ì˜ìˆ˜ì¦ ì‚¬ì§„ ì—…ë¡œë“œ</h3>
      <form id="ocrForm">
        <input type="file" id="fileInput" name="file" accept="image/*" required>
        <br><br>
        <button type="submit">OCR ì¶”ì¶œ</button>
      </form>
      <div id="ingredientResult"></div>
    </div>

    <!-- ë£°ë › ì„¹ì…˜ (ìš”ë¦¬ ì¶”ì²œ) -->
    <div class="roulette-section">
      <h4>ğŸ³ ì˜¤ëŠ˜ì˜ ìš”ë¦¬ ì¶”ì²œ </h4>
      <canvas id="rouletteCanvas" width="280" height="280" style="margin: 0 auto; display: block;"></canvas>
      <button onclick="spinRoulette()">ë£°ë › ëŒë¦¬ê¸°</button>
      <p id="rouletteResult" style="margin-top: 20px; font-weight: bold;"></p>
    </div>
  </div>
</div>

<script>
  const ocrForm = document.getElementById("ocrForm");
  const resultDiv = document.getElementById("ingredientResult");

  ocrForm.addEventListener("submit", function(e) {
    e.preventDefault();
    const file = document.getElementById("fileInput").files[0];
    const formData = new FormData();
    formData.append("file", file);

    fetch("/api/ocr", {
      method: "POST",
      body: formData
    })
            .then(res => res.text())
            .then(data => {
              const items = data.split(/[\n,]+/).filter(item => item.trim() !== "");
              resultDiv.innerHTML = "ğŸ“‹ ì¶”ì¶œëœ ì¬ë£Œ:<br>" + items.map(item => `<div class='ingredient-item'>â€¢ ${item}</div>`).join("");
            })
            .catch(err => {
              resultDiv.textContent = "âŒ ì˜¤ë¥˜ ë°œìƒ: " + err.message;
            });
  });

  const canvas = document.getElementById("rouletteCanvas");
  const ctx = canvas.getContext("2d");
  const radius = canvas.width / 2;
  let rouletteItems = [
    "ê¹€ì¹˜ë³¶ìŒë°¥", "ëœì¥ì°Œê°œ", "ê°ìì¡°ë¦¼", "ê³„ë€ë§ì´",
    "ë¶ˆê³ ê¸°", "ë¹„ë¹”êµ­ìˆ˜", "ë‹­ê°ˆë¹„", "ìƒëŸ¬ë“œë³¼",
    "ì—°ì–´ë®ë°¥", "ê¹€ë°¥", "ìœ ë¶€ì´ˆë°¥", "ë² ì´ì»¨ì—ê·¸ë¡¤"
  ];
  let angle = 0;
  let spinning = false;

  function drawRoulette() {
    const anglePerItem = (2 * Math.PI) / rouletteItems.length;
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    for (let i = 0; i < rouletteItems.length; i++) {
      const startAngle = angle + i * anglePerItem;
      const endAngle = startAngle + anglePerItem;

      ctx.beginPath();
      ctx.moveTo(radius, radius);
      ctx.arc(radius, radius, radius, startAngle, endAngle);
      ctx.fillStyle = i % 2 === 0 ? '#a5d6a7' : '#81c784';
      ctx.fill();

      ctx.save();
      ctx.translate(radius, radius);
      ctx.rotate(startAngle + anglePerItem / 2);
      ctx.fillStyle = 'black';
      ctx.font = '12px sans-serif';
      ctx.fillText(rouletteItems[i], radius / 2 - 15, 0);
      ctx.restore();
    }
  }

  function spinRoulette() {
    if (spinning) return;
    spinning = true;
    let totalRotation = Math.PI * 10 + Math.random() * 2 * Math.PI;
    const duration = 2000;
    const start = performance.now();

    function animate(now) {
      const elapsed = now - start;
      const progress = Math.min(elapsed / duration, 1);
      const eased = 1 - Math.pow(1 - progress, 3);
      angle = totalRotation * eased;
      drawRoulette();
      if (progress < 1) {
        requestAnimationFrame(animate);
      } else {
        const index = Math.floor(((2 * Math.PI - (angle % (2 * Math.PI))) / (2 * Math.PI)) * rouletteItems.length) % rouletteItems.length;
        const result = rouletteItems[index];
        document.getElementById("rouletteResult").textContent = `ğŸ‰ ì˜¤ëŠ˜ì˜ ì¶”ì²œ ìš”ë¦¬ëŠ” "${result}" ì…ë‹ˆë‹¤!`;
        spinning = false;
      }
    }

    requestAnimationFrame(animate);
  }

  drawRoulette();
</script>
</body>
</html>